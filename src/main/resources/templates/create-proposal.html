<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--Thymeleaf를 사용하여 소설 제목을 동적으로 표시 -->
    <title th:text="|Vibe Fiction ! ${novelData.title ?: '새 소설'} 이어쓰기|">
        Vibe Fiction ! 다음 챕터 쓰기
    </title>
    <!-- 외부 스타일시트 링크 -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/create-proposal.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>

    <!-- 메인 헤더 -->
    <div th:replace="~{fragments/mainHeader :: mainHeader}"></div>

    <!-- 메인 콘텐츠 영역 -->
    <main class="container main-content">
        <!-- (서버 사이드 렌더링) Thymeleaf를 사용하여 실제 소설 정보를 동적으로 표시합니다. -->
        <!-- th:if를 사용하여, novelData가 존재할 때만 이 블록이 렌더링되도록 합니다. -->
        <div th:object="${novelData}">
            <img th:src="*{coverImageUrl} ?: '/img/default-cover.png'" alt="소설 표지" class="novel-cover">
            <div class="novel-title-text" th:text="*{title}"></div>
        </div>

        <!-- novelData가 없을 경우, 사용자에게 상태를 알려주는 메시지를 표시합니다. -->
        <div th:if="${novelData == null}" class="novel-info-card missing">
            <p>소설 정보를 불러오는 데 실패했습니다.<br>올바른 경로로 접근했는지 확인해주세요.</p>
        </div>

        <section class="chapter-form-section">
            <h2>다음 이야기를 만들어주세요!</h2>
            <!-- 이 폼의 chapterId는 URL 경로를 통해 JavaScript에서 동적으로 인식합니다. -->
            <form id="createChapterForm">
                <!-- 챕터 소제목 -->
                <div class="form-group">
                    <label for="chapter-title">소제목</label>
                    <input type="text" id="chapter-title" name="title" placeholder="챕터의 소제목을 입력해주세요." required>
                </div>

                <!-- 챕터 내용 -->
                <div class="form-group">
                    <div class="chapter-content-header">
                        <label for="chapter-content">내용</label>
                        <div class="btn-group">
                            <button type="button" class="btn-prev-content">이전 내용 보기</button>
                            <button type="button" class="btn-ai-help">
                                <i class="fas fa-magic"></i> AI 도움받기
                            </button>
                        </div>
                    </div>
                    <textarea id="chapter-content" name="content" rows="15" placeholder="다음 챕터의 내용을 작성해주세요." required></textarea>
                </div>

                <button type="submit" class="btn btn-submit">완료</button>
            </form>
        </section>
    </main>

    <!-- 메인 푸터 -->
    <div th:replace="~{fragments/mainFooter :: mainFooter}"></div>

    <!--
      [리팩토링] 기존 <script> 태그의 내부 로직을 외부 파일로 분리했습니다.
      'type="module"'을 사용하여, 다른 JavaScript 파일(api.js)을 import 할 수 있도록 합니다.
      이제 이 페이지의 모든 동적인 기능은 /js/utils/create-proposal.js 파일이 담당합니다.
    -->
    <script type="module" src="/js/pages/create-proposal.js"></script>

</body>
</html>
