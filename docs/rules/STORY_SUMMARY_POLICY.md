# Relai – 스토리 요약 관리 정책

본 문서는 Relai 플랫폼에서 **릴레이 소설의 회차가 누적됨에 따라 발생하는 데이터 방대화 문제**를 해결하기 위해,
**AI 기반 자동 요약 생성 및 관리 정책**을 정의한 문서입니다.
이를 통해 AI 이어쓰기 품질을 유지하면서 API 비용과 처리 속도를 최적화하는 것을 목표로 합니다.

**작성자**: [왕택준](https://github.com/TJK98)

**문서 버전**: v1.0

**대상 독자:**

* **백엔드 개발자**: `chapter_summaries` 테이블 설계 및 AI 요약 생성 로직 구현
* **프론트엔드 개발자**: 이어쓰기 요청 시 요약 기반 데이터 제공 방식 적용
* **DBA**: DB 스키마 관리 및 성능 최적화 검토
* **운영자/Admin**: 요약본 검수 및 수정 가능 기능 관리
* **신규 합류자**: Relai 플랫폼의 스토리 요약 구조 및 필요성 이해

---

## **1. 목적**

릴레이 소설은 회차가 누적될수록 데이터가 방대해집니다.
현 구조는 **모든 회차(1화\~N화) 전체 내용을 AI 프롬프트에 전달**하기 때문에, 다음과 같은 문제가 발생합니다:

* AI 요청 시 **프롬프트 토큰 초과** 가능성 증가
* 응답 속도 저하 및 비용 증가
* 불필요한 상세 묘사 반복으로 **AI 응답 품질 저하**

이를 해결하기 위해, **회차 생성 시점에 자동으로 요약을 생성·저장**하는 “스토리 요약 관리 정책”을 도입합니다.

---

## **2. 설계 개요**

### 2.1. 새로운 DB 테이블: `chapter_summaries`

| 컬럼명            | 타입          | 설명                           |
| -------------- | ----------- | ---------------------------- |
| `summary_id`   | BIGINT (PK) | 요약 고유 ID                     |
| `chapter_id`   | BIGINT (FK) | 원본 회차(`Chapters`) 참조         |
| `summary_text` | TEXT        | 해당 회차의 요약 (최대 500\~1000자 권장) |
| `created_at`   | DATETIME    | 요약 생성 시각                     |
| `updated_at`   | DATETIME    | 요약 갱신 시각 (필요 시)              |

---

### 2.2. 동작 흐름

1. **신규 회차 생성 (`Chapters`)**

   * 사용자가 이어쓰기를 등록 → `Chapters`에 저장

2. **AI 요약 생성 요청**

   * 신규 회차 본문을 AI에 전달
   * 요약 규칙:

     * 등장인물/사건/변화 중심
     * 최대 500\~1000자
     * 스포일러 없이 핵심 정보만 유지

3. **요약 저장 (`chapter_summaries`)**

   * 해당 회차 요약을 DB에 저장
   * 추후 “전체 스토리 컨텍스트” 대신 요약들을 연결해 AI에게 제공

4. **AI 이어쓰기 요청 시**

   * `chapter_summaries`에서 최근 N개 요약을 불러와 컨텍스트 구성
   * 필요 시 **첫 1\~3화는 원문 그대로, 이후는 요약** 조합 가능

---

## **3. 기대 효과**

* **프롬프트 크기 절감** → 속도 개선, API 비용 절감
* **맥락 유지 강화** → AI가 방대한 내용 속 핵심을 더 정확히 반영
* **유연한 전략 가능**

  * 초기 회차는 원문 그대로 사용
  * 중후반부는 요약본 기반
  * “전체 요약” 생성 → 10\~20화 단위 아카이빙

---

## **4. 추후 업데이트 계획**

1. **요약 생성 전략 고도화**

   * 단순 요약 → 스토리 아크 단위 요약(10화 묶음)
   * 인물별 요약, 세계관 설정 요약 등 확장 가능

2. **에디터 기능**

   * 운영자/Admin이 요약본을 직접 수정할 수 있는 관리 도구 제공

3. **AI 품질 보정**

   * 요약이 반복적으로 누락/왜곡될 경우, 요약+원문 혼합 전략으로 보완

---

결론:
→ 앞으로는 `Chapters` + `ChapterSummaries` 2계층 구조로 관리합니다.
→ AI 프롬프트는 **“요약본 위주 + 필요 시 원문 일부”** 방식을 채택하여 성능/품질을 동시에 확보합니다.
