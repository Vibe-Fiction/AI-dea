# Relai: 릴레이 연재 시스템 운영 정책

작성자: [왕택준](https://github.com/TJK98)

**문서 버전: 1.0**

> **문서 개요**: 본 문서는 Relai 플랫폼의 핵심 기능인 '릴레이 연재 시스템'의 운영 정책과 자동화된 처리 규칙을 정의합니다. 이 문서는 백엔드 로직, 데이터베이스 스키마, 프론트엔드 UI/UX 설계의 기준이 되는 **단일 진실 공급원(Single Source of Truth)** 역할을 합니다.

---

## **1. 소설의 핵심 상태 (`Novel Status`)**

모든 소설(`Novel`)은 현재의 진행 상황을 나타내는 아래 4가지 상태 중 하나를 가집니다.

| 상태명 (`status`) | 설명 | 트리거 조건 |
| :--- | :--- | :--- |
| **`ONGOING`** | **연재 진행**: 새로운 제안을 받거나 투표가 진행 중인 정상 상태. | 소설 생성 시 기본 상태. 다음 회차 채택 완료 시 이 상태로 복귀. |
| **`AWAITING_AUTHOR`** | **작성자 결정 대기**: 투표 결과 동률 발생 등으로 직전 회차 작성자의 개입이 필요한 상태. | 자동 처리 로직 Case 3, 4 참조. |
| **`COMPLETED`** | **완결**: 작성자에 의해 연재가 공식적으로 종료된 상태. 더 이상 이어쓰기 불가. | 작성자가 '완결하기' 기능 사용 시. |
| **`HIDDEN`** | **숨김 (휴재)**: 장기 미업데이트로 인해 시스템이 자동으로 비공개 처리한 상태. | 마지막 회차 등록 후 30일 경과 시. |

---

## **2. 릴레이 라운드 규칙**

### **2.1. 투표 기간**

*   **원칙**: 새로운 회차(`Chapter`)가 등록된 시점을 기준으로, 다음 화 제안 및 투표가 가능한 시간은 **72시간(3일)으로 고정**됩니다.
*   **기술적 구현**: `Chapter` 테이블의 `created_at` 또는 `Novel` 테이블의 `last_chapter_updated_at`을 기준 시점으로 설정합니다. 투표 마감 시각(`vote_deadline`)은 이 기준 시점으로부터 정확히 72시간 후로 계산됩니다.
*   **목적**: 모든 제안(`Proposal`)이 동일한 마감 시간을 공유하여 공정한 경쟁 환경을 보장합니다.

### **2.2. 투표 규칙**

*   **자기 투표 금지**: 사용자는 자신이 작성한 제안(`Proposal`)에 투표할 수 없습니다. (프론트엔드에서 버튼 비활성화, 백엔드에서 유효성 검증 필요)
*   **중복 투표 불가**: 사용자는 하나의 릴레이 라운드에서 단 하나의 제안에만 투표할 수 있습니다.

---

## **3. 투표 마감 시 자동 처리 규칙 (스케줄러)**

백엔드 스케줄러는 매 라운드의 `vote_deadline`이 도래했을 때, 아래 우선순위에 따라 다음 회차를 확정합니다.

| 우선순위 | 상황 (Case) | 시스템 처리 방안 | `Novel` 상태 전환 |
| :--- | :--- | :--- | :--- |
| **1** | **단독 최다 득표**: 단 하나의 제안이 가장 많은 표를 얻은 경우. | 해당 제안을 **자동으로 다음 회차(`Chapter`)로 채택**하고 새 라운드 시작. | `ONGOING` → `ONGOING` |
| **2** | **복수 최다 득표 (동률)**: 2개 이상의 제안이 동일한 최다 득표를 기록한 경우. | 동률 제안들을 대상으로 **직전 회차 작성자에게 48시간의 선택권 부여.** | `ONGOING` → `AWAITING_AUTHOR` |
| **3** | **무투표 제안 발생**: 제안이 존재하지만 아무도 투표하지 않은 경우. | 모든 제안을 대상으로 **직전 회차 작성자에게 48시간의 선택권 부여.** | `ONGOING` → `AWAITING_AUTHOR` |
| **4** | **제안 없음 (1차)**: 투표 기간 동안 제안이 하나도 등록되지 않은 경우. | **투표 기간을 72시간 자동 연장**하고, 연장 사실을 UI에 표시. | `ONGOING` → `ONGOING` |
| **5** | **제안 없음 (2차)**: 연장된 기간에도 제안이 없는 경우. | 소설의 상태를 **`HIDDEN`으로 자동 전환.** (장기 미업데이트 처리와 동일) | `ONGOING` → `HIDDEN` |

### **`AWAITING_AUTHOR` 상태의 후속 처리**

*   **선택권 부여**: 상태 전환 시, 직전 회차 작성자에게 알림을 보내고 48시간의 결정 타이머를 시작합니다.
*   **작성자 미응답 시**: 48시간 내에 작성자가 선택하지 않을 경우, 시스템은 **동률(또는 무투표) 제안 중 가장 먼저 등록된 제안을 자동으로 채택**하여 연재를 강제로 이어나갑니다.

---

## **4. 장기 미업데이트 소설 처리**

*   **규칙**: 소설의 마지막 회차(`Chapter`)가 등록된 시점으로부터 **30일**이 경과하면, 해당 소설의 상태는 자동으로 **`HIDDEN`**으로 변경됩니다.
*   **해제 조건**: `HIDDEN` 상태의 소설은 작성자가 직접 '연재 재개' 등의 액션을 통해 다시 `ONGOING` 상태로 복구할 수 있습니다.
