# Git 워크플로우 규칙

> [↩ 규칙 허브로 돌아가기](../CONTRIBUTING.md)

본 문서는 **Team Ai-dea**의 Vibe Fiction 프로젝트에서 Git 브랜치 전략, 커밋/PR 작성 규칙, 이슈 관리 규칙을 정의합니다.

작성자: [왕택준](https://github.com/TJK98)

---

## 1. 브랜치 전략 및 구조

### 브랜치 종류

| 브랜치         | 용도                                                    |
|----------------|---------------------------------------------------------|
| `main`         | 최종 결과물 (배포용 전용 브랜치, 직접 작업 금지)                    |
| `dev`          | 통합 개발 브랜치 (모든 기능 브랜치의 병합 대상)                         |

### 브랜치 네이밍 컨벤션

- `feature/기능명` → 새 기능 개발
- `fix/버그명` → 버그 수정
- `refactor/모듈명` → 리팩토링
- `docs/문서명` → 문서 추가 또는 수정
- `hotfix/급한수정` → 배포 직전 긴급 수정 (예: main에서 분기)

예시:
- **`feature/user-profile`**: 사용자 프로필 기능 개발
- **`fix/login-password-error`**: 로그인 시 비밀번호 오류 수정
- **`refactor/user-service`**: UserService 코드 구조 개선
- **`docs/contributing-guide`**: 기여 가이드 문서 작성
- **`hotfix/critical-login-failure`**: 긴급 로그인 불가 문제 해결

- GitHub의 **기본 브랜치**는 `dev`로 설정합니다.
- 모든 기능 개발은 `feature/*` 브랜치에서 시작하고, 작업 완료 시 `dev`로 PR을 생성합니다.

### 브랜치 보호 규칙

| 브랜치    | 보호 설정              | 설명                                     |
|-----------|------------------------|------------------------------------------|
| `main`    | main-protection 적용   | 직접 커밋/삭제 금지, 오직 PR 병합만 허용        |
| `dev`     | dev-protection 적용    | PR 리뷰 승인 후에만 병합 가능 (직접 푸시 금지) |

---

## 2. 기능 개발 브랜치 작업 흐름

1. **로컬 dev 브랜치 동기화**
    ```bash
    git fetch origin
    git switch dev
    git pull origin dev
    ```

2. **기능 브랜치 생성 및 이동**
    ```bash
    git switch -c feature/기능명
    # 예: feature/story-upload
    ```

3. **작업 & 커밋 & 푸시**
    ```bash
    git add .
    git commit -m "feat: 스토리 업로드 기능 구현"
    git push origin feature/기능명
    ```

4. **GitHub에서 PR 생성 (feature/* → dev)**

5. **병합 완료 후 브랜치 삭제**
    ```bash
    git switch dev
    git branch -d feature/기능명
    git push origin --delete feature/기능명
    ```

---

## 3. 커밋 메시지 규칙

### 커밋 메시지 형식

```text
<타입>: <변경 요약>
```

| 타입         | 설명                             |
|--------------|----------------------------------|
| `feat`       | 새로운 기능 추가                   |
| `fix`        | 버그 수정                         |
| `refactor`   | 리팩토링 (기능 변화 없음)          |
| `style`      | 코드 포맷팅, 세미콜론 누락 등      |
| `docs`       | 문서 수정 및 추가                  |
| `chore`      | 빌드 설정, 패키지 관리 등 기타 변경 |
| `test`       | 테스트 코드 추가 및 수정           |

### 예시
커밋 메시지에 이슈 번호를 포함하는 것을 규칙으로 명시

```bash
feat: 스토리 생성 API 구현 (#23)
fix: 회원가입 시 이메일 중복 검사 오류 수정 (#14)
refactor: 스토리 작성 컴포넌트 로직 분리 (#30)
docs: Git 협업 규칙 문서 업데이트 (#2)
```

---

## 4. PR(Pull Request) 작성 규칙

### 제목 형식

`[타입]: 상세 내용 (#이슈 번호)` (예: `feat: 로그인 기능 구현 (#12)`)
- feat: 새로운 기능 추가
- fix: 버그 수정
- refactor: 리팩토링 (기능 변경 없이 구조 개선)
- docs: 문서 수정
- test: 테스트 코드 추가/수정
- style: 코드 포맷팅, 세미콜론 누락 등
- chore: 빌드 업무 수정, 패키지 매니저 설정 등

### 본문

PR 생성 시 `.github/PULL_REQUEST_TEMPLATE.md`에 정의된 템플릿이 자동으로 적용됩니다. 각 항목에 맞게 내용을 기재해주세요.

※ **불필요한 항목은 삭제 가능합니다.**

> ❗ PR 작성자는 반드시 본인의 로컬에서 기능 테스트를 완료한 후 올려야 합니다.

---

## 5. 코드 리뷰 및 테스트 규칙

- **최소 리뷰 인원**: 팀원 **1인 이상에게 Approve**를 받아야 병합 가능
- **자기 PR 직접 병합 금지**: 본인이 올린 PR은 **Merge 금지**
- **기능 실행 테스트 필수**: 리뷰어는 해당 브랜치를 직접 로컬에서 실행하여 검증합니다.

### 코드 리뷰 절차

1. **브랜치 방향 확인**
   예: `feature/story-upload` → `dev`

2. **변경 코드 확인**
   GitHub의 `Files changed` 탭에서 전체 변경 사항 확인

3. **로컬 테스트**
   ```bash
   git fetch origin
   git checkout feature/브랜치명  # 리뷰할 브랜치로 이동
   # 실행 후 실제 기능 확인 (예: AI 생성 테스트, 스토리 업로드 등)
   ```

4. **피드백 작성 및 승인**
   - `LGTM!`, `수고하셨습니다` 등 코멘트 + Approve
   - 문제가 있거나 수정이 필요한 경우 `Changes requested` 선택 + 구체적 피드백

### 충돌(Conflict) 처리 규칙

- **충돌 발생 시 PR 작성자가 직접 해결**
  - 리뷰어 승인 전까지 로컬 환경에서 해결 후 `git push`로 갱신
- **해결 절차**
  1. 최신 `dev` 브랜치를 로컬로 가져오기
     ```bash
      # 1. 원격 저장소의 최신 정보를 가져옵니다.
      git fetch origin

      # 2. 내 작업 브랜치로 이동합니다.
      git checkout feature/브랜치명

      # 3. 최신 dev 브랜치의 내용을 내 브랜치로 병합합니다. (이때 충돌이 발생할 수 있음)
      git merge origin/dev
     ```
  2. 충돌 파일을 열어 수정 후 저장
  3. 수정 완료 후 커밋 & 푸시
     ```bash
     git add .
     git commit -m "Resolve merge conflict: 파일명"
     git push origin feature/브랜치명
     ```
- **주의 사항**
  - 충돌 시 무조건 자신의 코드만 살리지 말고, 상대방 변경 사항을 반영할 수 있는지 검토
  - 충돌 해결 후 반드시 **기능 재테스트** 진행

### Merge Commit 메시지 규칙

PR 병합 시 생성되는 Merge commit 메시지는 다음 규칙을 따릅니다.

#### 1. 기본 형식
```
<타입>: <변경 요약> (#PR번호)

- 주요 변경 사항 1
- 주요 변경 사항 2
- (선택) Closes #이슈번호
- (선택) Refs #이슈번호
```

#### 2. 작성 방법

이 규칙은 **PR을 병합(Merge)하는 리뷰어**가 **병합 시점**에 작성합니다.
GitHub의 'Merge pull request' 버튼을 누를 때 나타나는 **텍스트 박스를 직접 수정**하여 아래 형식에 맞춥니다.

1. **제목 줄**
   - PR 병합 시의 커밋 메시지는 **PR의 제목을 그대로 사용하는 것을 원칙**으로 합니다.
   - PR 제목은 `[타입]: 상세 내용 (#이슈번호)` 형식을 따르므로, 최종 커밋 메시지 또한 자연스럽게 이 형식을 따르게 됩니다.
   - 예: `feat: 소설 이어쓰기 + AI 추천 기능 구현 (#30)`

2. **본문**
   - PR 본문의 `작업 내용 요약`에서 핵심 변경 사항만 bullet 형식으로 옮깁니다.
   - 예:
     ```
     - 새 소설 쓰기 페이지와 이어쓰기 페이지 UI/기능 구현
     - AI 추천 기능 API 연동 완료
     ```

3. **이슈 참조**
   - **`Closes #이슈번호`**: 이 PR이 해당 이슈를 **완전히 해결**했을 때 사용합니다. PR이 병합되면 해당 이슈는 **자동으로 닫힙니다.**
   - **`Refs #이슈번호`**: 이 PR이 해당 이슈와 **관련은 있지만, 완전히 해결하지는 않을 때** 사용합니다. (예: 일부 기능만 구현) 이슈는 닫히지 않고 연결만 됩니다.

   - 예시:
     ```
     Closes #30
     Refs #31, #32
     ```

#### 3. 예시 메시지
```
feat: 소설 이어쓰기 + AI 추천 기능 구현 (#45)

- 새 소설 쓰기 페이지와 이어쓰기 페이지 UI/기능 구현
- AI 추천 기능 API 연동 완료
Closes #30
Refs #31, #32
```

> 💡 참고: 규칙이 없을 경우 GitHub 기본 Merge commit 메시지(PR 제목 + 번호)를 사용해도 무방하나, 가능하면 위 형식으로 통일합니다.

> 💡 **Tip: "Squash and Merge" 전략 사용 권장**
>
> 우리 팀은 `dev` 브랜치의 히스토리를 깔끔하게 유지하기 위해 **"Squash and Merge"** 방식의 병합을 권장합니다.
> PR을 병합할 때, GitHub의 "Merge pull request" 드롭다운 버튼을 눌러 "Squash and Merge"를 선택하세요.
>
> 이렇게 하면 기능 브랜치의 모든 커밋이 하나의 커밋으로 합쳐지며, 이때 위에서 정의한 **Merge Commit 메시지 규칙에 따라** 커밋 메시지를 작성하면 됩니다.

---

## 6. 이슈 관리 규칙

### 이슈 생성 원칙

- 모든 작업은 **이슈 먼저 생성** → **자신을 Assignee로 지정** 후 진행
- 커밋과 PR에는 해당 이슈 번호를 반드시 태그합니다

### 본문

이슈 생성 시 `.github/ISSUE_TEMPLATE/`에 정의된 템플릿을 선택하여 작성할 수 있습니다. 목적에 맞는 템플릿을 사용하여 필요한 정보를 기재해주세요.

※ **불필요한 항목은 삭제 가능합니다.**

> **참고**: `---`로 감싸인 상단 영역은 GitHub가 이슈의 제목, 라벨 등을 자동으로 설정하기 위해 사용하는 부분입니다.

---

## 7. 참고
- 심화 Git 사용법(Rebase, Hotfix 등)은 [심화 Git 가이드](./advanced-git-guide.md) 참고
